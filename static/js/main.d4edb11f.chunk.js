(this["webpackJsonpsound-painting"]=this["webpackJsonpsound-painting"]||[]).push([[0],{34:function(e,t,n){},35:function(e,t,n){},46:function(e,t,n){},47:function(e,t,n){},57:function(e,t,n){"use strict";n.r(t);var a=n(13),i=n(8),o=n.n(i),s=n(22),r=n.n(s),c=n(14),l=(n(34),n(69)),u=(n(35),n(7)),d=n.n(u),p=n(9),h=n(10),f=n(12),v=n(11),g=n(0),m=n(1),y=n(18),j=n(27),b=new(function(){function e(){var t=this;Object(g.a)(this,e),this.painting=null,this.loadedSounds=new Map,this.players=new Map,this.meters=new Map,this.soundSourceLevels=new Map,this.soundSourceRipples=new Map,this.overlayFade=1,this.isOverlayVisible=!0,this.animateSoundSources=function(){var e,n=Object(f.a)(t.meters.entries());try{for(n.s();!(e=n.n()).done;){var a=e.value,i=Object(h.a)(a,2),o=i[0],s=i[1],r=y.d(s.getValue());t.soundSourceRipples.set(o,r)}}catch(c){n.e(c)}finally{n.f()}requestAnimationFrame((function(){t.animateSoundSources()}))},Object(c.f)(this,{painting:c.g,loadedSounds:c.g,soundSourceLevels:c.g,soundSourceRipples:c.g,overlayFade:c.g,isOverlayVisible:c.g,isLoaded:c.c}),this.setMouseListeners(),requestAnimationFrame((function(){t.animateSoundSources()}))}return Object(m.a)(e,[{key:"isLoaded",get:function(){return Object(v.a)(this.loadedSounds.values()).every((function(e){return 1==e}))}}]),Object(m.a)(e,[{key:"setMouseListeners",value:function(){var e=this;window.addEventListener("mousemove",(function(t){var n=window.innerWidth,a=window.innerHeight;e.setSoundPosition(t.pageX/n,t.pageY/a)}),!1)}},{key:"setPainting",value:function(e){var t=this;this.painting=e;var n=e.key;e.sounds.forEach((function(e){var a=e.file;if(!t.players.get(a)){var i="".concat("/listen-paintings","/").concat(n,"/").concat(a),o=new y.b(i,(function(){console.log("loaded",a),t.loadedSounds.set(a,!0);for(var e=o.buffer.getChannelData(0),n=2048,i=0,s=0,r=0;r<e.length;r+=n){for(var c=0,l=Math.min(e.length,r+n),u=r;u<l;u++)c+=Math.pow(e[u],2),s+=Math.pow(e[u],2);var d=Math.sqrt(1/n*c);i=Math.max(d,i)}var p=Math.sqrt(1/e.length*s),h=Math.log(p)/Math.log(10)*20,f=Math.log(i)/Math.log(10)*20;console.log("avg: ".concat(h.toFixed(2),"db, max: ").concat(f.toFixed(2),"db"))}));t.players.set(a,o),o.loop=!0;var s=void 0===e.volume?0:e.volume,r=new y.c(-12+s).toDestination();o.connect(r);var c=new y.a(.1);r.connect(c),t.meters.set(a,c),t.loadedSounds.set(a,!1)}}))}},{key:"playSounds",value:function(){var e=Object(p.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.f();case 2:this.painting.sounds.forEach((function(e){var n=t.players.get(e.file);n&&"started"!==n.state&&n.start()}));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fadeOutOverlay",value:function(){var e=Object(p.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.animatedOverlay){e.next=2;break}return e.abrupt("return");case 2:return this.animatedOverlay=new j.a({start:1,end:0}),e.next=5,this.animatedOverlay.play(500,(function(){t.overlayFade=t.animatedOverlay.value()}));case 5:this.isOverlayVisible=!1,this.animatedOverlay=null;case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setSoundPosition",value:function(e,t){var n=this;this.painting.sounds.forEach((function(a){var i=document.getElementById(a.file),o=Object(h.a)(a.position,2),s=o[0],r=o[1],c=a.radius;if(i){var l=Math.abs(s-e),u=Math.abs(r-t),d=Math.sqrt(Math.pow(l,2)+Math.pow(u,2)),p=1-Math.min(1,d/c),f=y.e(p),v=n.players.get(a.file);n.soundSourceLevels.set(a.file,p),v&&(v.volume.value=f+-12)}}))}}]),e}());n(46);var O=Object(l.a)((function(){var e={opacity:.75*b.overlayFade};return Object(a.jsx)("div",{className:"overlay",style:e,children:b.isLoaded?Object(a.jsx)("span",{className:"state loaded",onClick:function(){b.fadeOutOverlay(),b.playSounds()},children:"Start"}):Object(a.jsx)("div",{className:"state loading",children:"Loading..."})})})),w=n(25),x=n.n(w),S=(n(47),100),M=1.1;var k=function(e){var t=e.sound,n=Object(h.a)(t.position,2),o=n[0],s=n[1],r=Object(i.useRef)(null),l=Object(i.useRef)(null);Object(i.useEffect)((function(){var e=Object(c.b)((function(){var e=b.soundSourceLevels.get(t.file),n=b.soundSourceRipples.get(t.file);if(void 0!=e){var a=r.current,i=l.current,o=.5*e+.5;o*=1-b.overlayFade;var s=40*e+80;a.style.opacity=o,a.style.width="".concat(s,"px"),a.style.height="".concat(s,"px"),a.style.marginLeft="".concat(-s/2,"px"),a.style.marginTop="".concat(-s/2,"px");var c=function(e){return 1-Math.pow(1-e,20)}(n),u=s*M+120*c;i.style.opacity=o,i.style.width="".concat(u,"px"),i.style.height="".concat(u,"px"),i.style.marginLeft="".concat(-u/2,"px"),i.style.marginTop="".concat(-u/2,"px")}}));return function(){e()}}),[]);var u={width:"".concat(S,"px"),height:"".concat(S,"px"),marginLeft:"".concat(-50,"px"),marginTop:"".concat(-50,"px"),left:"".concat(100*o,"%"),top:"".concat(100*s,"%"),backgroundColor:t.color,opacity:0},d={width:"".concat(110.00000000000001,"px"),height:"".concat(110.00000000000001,"px"),marginLeft:"".concat(-55.00000000000001,"px"),marginTop:"".concat(-55.00000000000001,"px"),left:"".concat(100*o,"%"),top:"".concat(100*s,"%"),opacity:0};return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("div",{ref:l,className:"ripple",style:d}),Object(a.jsx)("div",{id:t.file,ref:r,className:"sound-icon",style:u,children:Object(a.jsx)(x.a,{style:{fontSize:48}})})]})};var L,N=Object(l.a)((function(){var e=b.painting,t="".concat("/listen-paintings","/").concat(e.key,"/image.jpg");return Object(a.jsx)("div",{className:"App",children:Object(a.jsxs)("div",{className:"image-container",children:[b.isOverlayVisible?Object(a.jsx)(O,{}):null,e.sounds.map((function(e){return Object(a.jsx)(k,{sound:e},e.file)})),Object(a.jsx)("img",{src:t,className:"painting",alt:""}),Object(a.jsxs)("div",{className:"image-description",children:[Object(a.jsx)("span",{className:"title",children:e.name}),Object(a.jsx)("span",{className:"artist",children:e.artist})]})]})})})),F=[{name:"Wheatfield with Crows",artist:"Vincent Van Gogh",key:"van_gogh",width:3508,height:1669,sounds:[{file:"wheat.mp3",position:[.3,.65],radius:.6,color:"coral"},{file:"crow.mp3",position:[.8,.4],radius:.5,color:"coral"}]},{name:"Girl in a Boat with Geese",artist:"Berthe Morisot",key:"morisot",width:3392,height:4096,sounds:[{file:"geese.mp3",position:[.85,.65],radius:.4,color:"coral"},{file:"humming.wav",position:[.5,.25],radius:.3,color:"coral"},{file:"rowing.mp3",position:[.34,.55],radius:.3,color:"coral",volume:-12}]},{name:"Impression, Sunrise",artist:"Claude Monet",key:"monet",width:1280,height:993,sounds:[{file:"foghorn.mp3",position:[.1,.15],radius:.3,color:"coral"},{file:"gulls.mp3",position:[.8,.2],radius:.5,color:"coral"},{file:"harborwaves.mp3",position:[.5,.8],radius:.7,color:"coral"}]}];Object(c.d)({enforceActions:"never"});var E=Object.fromEntries(new URLSearchParams(window.location.search)).painting,R=null!==(L=F.find((function(e){return e.key===E})))&&void 0!==L?L:F[1];b.setPainting(R),r.a.render(Object(a.jsx)(o.a.StrictMode,{children:Object(a.jsx)(N,{})}),document.getElementById("root"))}},[[57,1,2]]]);
//# sourceMappingURL=main.d4edb11f.chunk.js.map